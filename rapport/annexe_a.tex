


\newcommand{\fleche}{\Rightarrow}
\newcommand{\et}{\wedge}

\newcommand{\N}{I\hspace{-0.3em}N}

\newcommand{\nil}{\textsf{nil}}
\newcommand{\true}{\textsf{true}}
\newcommand{\bool}{\textsf{bool}}

\newcommand{\tab}[1]{\mbox{}\hspace{#1}}


%% \begin{quote}
%% {\Large REMARQUE:} dans la doc de l'atelier B, sur les oblogations de preuves d'une
%% implémentation, il faut lire «$[u_1 := u_1']$» au lieu de «$[u_1 : u_1']$» et,
%% «$u_1 = u_1'$» au lieu de «$u_1 u_1'$». Ces mystérieus $u_1$ et $u_1'$ sont les noms des
%% \textbf{paramètres de retour des opérations}. On renome ceux du raffinement (ici, l'implèm.)
%% et c'est ainsi que le lien est fait entre les résultats des opérations des machines abstraites 
%% et concrètes !
%% \end{quote}

\section*{Annexe A : Exemple d'obligation de preuve pour l'opération}

\paragraph{}
Cette obligation de preuve correspond à l'opération de l'implantation
\texttt{Integr\_i}. 
La démonstration à la main prend ici 19 étapes.

\bigskip\noindent
(1)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$[zz:=xx+reg1; yy'\longleftarrow bound(-1024, zz, 1023); reg1:=yy']$ \\
$\neg[yy:\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}]$ \\
$\neg(reg1\in INT\et reg1\in[-1024..1023]\et yy = yy')$

\bigskip\noindent
(2)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$[zz:=xx+reg1;yy'\longleftarrow bound(-1024, zz, 1023); reg1:=yy']$ \\
$\neg[ANY~ vv ~WHERE~ vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \} THEN yy:=vv]$ \\
$\neg(reg1\in INT\et reg1\in[-1024..1023]\et yy = yy')$

\bigskip\noindent
(3)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$[zz:=xx+reg1;yy'\longleftarrow bound(-1024, zz, 1023); reg1:=yy']$ \\
$\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{1em} \fleche [yy:=vv]\neg(reg1\in INT\et reg1\in[-1024..1023]\et yy = yy')))$

\bigskip\noindent
(4)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$[zz:=xx+reg1;yy'\longleftarrow bound(-1024, zz, 1023); reg1:=yy']$ \\
$\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{1em}  \fleche \neg[yy:=vv](reg1\in INT\et reg1\in[-1024..1023]\et yy = yy')))$

\bigskip\noindent
(5)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$[zz:=xx+reg1;yy'\longleftarrow bound(-1024, zz, 1023); reg1:=yy']$ \\
$\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{1em}  \fleche \neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy')))$

\bigskip\noindent
(6)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$[zz:=xx+reg1;yy\longleftarrow bound(-1024, zz, 1023); reg1:=yy']$ \\
$\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{1em} \fleche\neg(reg1\in INT\et reg1\in[-1024..1023])\et vv = yy'))$

\bigskip\noindent
(7)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$[zz:=xx+reg1] [yy'\longleftarrow bound(-1024, zz, 1023); reg1:=yy']$ \\
$\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{1em} \fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy')))$


\bigskip\noindent
(8)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$[yy'\longleftarrow bound(-1024, {\mathbf {xx+reg1}}, 1023); reg1:=yy']$ \\
$\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{1em} \fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy')))$

\bigskip\noindent
(9)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$[c1:= {xx+reg1} < -1024; IF~ c1 ~THEN~ aa := -1024 ~ELSE~ aa := {xx+reg1};$\\
$\tab{0.3em} c2:= aa > 1023; IF~ c2 ~THEN~ yy' := 1023 ~ELSE~ yy' := aa; reg1:=yy']$\\
$\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{1em} \fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy')))$

\bigskip\noindent
(10)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$[IF~ ({xx+reg1} < -1024) ~THEN~ aa := -1024 ~ELSE~ aa := {xx+reg1};$\\
$\tab{0.3em} c2:= aa > 1023; IF~ c2 ~THEN~ yy' := 1023 ~ELSE~ yy' := aa; reg1:=yy']$\\
$\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{1em} \fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy')))$

% expansion du IF~ ({xx+reg1} < -1024)
\bigskip\noindent
(11)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$(({xx+reg1} < -1024)\fleche$\\
$\tab{1em}[aa := -1024][c2:= aa > 1023; IF~ c2 ~THEN~ yy' := 1023 ~ELSE~ yy' := aa; reg1:=yy']$\\
$\tab{1em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{2em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy'))))$\\
$\et$\\
$(\neg({xx+reg1} < -1024)\fleche$\\
$\tab{1em}[aa := {xx+reg1}][c2:= aa > 1023; IF~ c2 ~THEN~ yy' := 1023 ~ELSE~ yy' := aa; reg1:=yy']$\\
$\tab{1em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{2em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy'))))$


\bigskip\noindent
(12)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$(({xx+reg1} < -1024)\fleche$\\
$\tab{1em}[c2:= -1024 > 1023; IF~ c2 ~THEN~ yy' := 1023 ~ELSE~ yy' := -1024; reg1:=yy']$\\
$\tab{1em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{2em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy'))))$\\
$\et$\\
$(\neg({xx+reg1} < -1024)\fleche$\\
$\tab{1em}[c2:= xx+reg1 > 1023; IF~ c2 ~THEN~ yy' := 1023 ~ELSE~ yy' := xx+reg1; reg1:=yy']$\\
$\tab{1em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{2em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy'))))$

\bigskip\noindent
(13)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$(({xx+reg1} < -1024)\fleche$\\
$\tab{1em}[c2:= -1024 > 1023] [IF~ c2 ~THEN~ yy' := 1023 ~ELSE~ yy' := -1024; reg1:=yy']$\\
$\tab{1em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{2em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy'))))$\\
$\et$\\
$(\neg({xx+reg1} < -1024)\fleche$\\
$\tab{1em}[c2:= xx+reg1 > 1023] [IF~ c2 ~THEN~ yy' := 1023 ~ELSE~ yy' := xx+reg1; reg1:=yy']$\\
$\tab{1em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{2em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy'))))$


\bigskip\noindent
(14)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$(({xx+reg1} < -1024)\fleche$\\
$\tab{1em}[IF~ (-1024 > 1023) ~THEN~ yy' := 1023 ~ELSE~ yy' := -1024; reg1:=yy']$\\
$\tab{1em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{2em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy')))$\\
$\et$\\
$(\neg({xx+reg1} < -1024)\fleche$\\
$\tab{1em}[IF~ ( {xx+reg1} > 1023) ~THEN~ yy' := 1023 ~ELSE~ yy' := {xx+reg1}; reg1:=yy']$\\
$\tab{1em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{2em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy'))))$

% développement des IF~ (... > 1023)
\bigskip\noindent
(15)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$(({xx+reg1} < -1024)\fleche$\\
$\tab{1em}((-1024 > 1023)\fleche$\\
$\tab{2em}[yy' := 1023; reg1:=yy']$\\
$\tab{2em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy'))))$\\
$\tab{1em}\et$\\
$\tab{1em}(\neg(-1024 > 1023)\fleche$\\
$\tab{2em}[yy' := -1024; reg1:=yy']$\\
$\tab{2em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy')))))$
$\et$\\
$(\neg({xx+reg1} < -1024)\fleche$\\
$\tab{1em}(({xx+reg1} > 1023)\fleche$\\
$\tab{2em}[yy' := 1023; reg1:=yy']$\\
$\tab{2em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy'))))$
$\tab{1em}\et$\\
$\tab{1em}(\neg( {xx+reg1} > 1023)\fleche$\\
$\tab{2em}[yy' := {xx+reg1}; reg1:=yy']$\\
$\tab{2em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy')))))$


\bigskip\noindent
(16)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$(({xx+reg1} < -1024)\fleche$\\
$\tab{1em}((-1024 > 1023)\fleche$\\
$\tab{2em}[reg1:=1023][yy' := 1023]$\\
$\tab{2em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy')))$
$\tab{1em}\et$\\
$\tab{1em}(\neg(-1024 > 1023)\fleche$\\
$\tab{2em}[reg1:=-1024][yy' := -1024]$\\
$\tab{2em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy'))))))$
$\et$\\
$(\neg({xx+reg1} < -1024)\fleche$\\
$\tab{1em}(({xx+reg1} > 1023)\fleche$\\
$\tab{2em}[reg1:=1023][yy' := 1023]$\\
$\tab{2em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy'))))$
$\tab{1em}\et$\\
$\tab{1em}(\neg( {xx+reg1} > 1023)\fleche$\\
$\tab{2em}[reg1 := {xx+reg1}][yy' := {xx+reg1}]$\\
$\tab{2em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em}\fleche\neg(reg1\in INT\et reg1\in[-1024..1023]\et vv = yy')))))$

\bigskip\noindent
(17)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$(({xx+reg1} < -1024)\fleche$\\
$\tab{1em}((-1024 > 1023)\fleche$\\
$\tab{2em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em}\fleche\neg[reg1:=1023][yy' := 1023](reg1\in INT\et reg1\in[-1024..1023]\et vv = yy'))))$
$\tab{1em}\et$\\
$\tab{1em}(\neg(-1024 > 1023)\fleche$\\
$\tab{2em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em}\fleche\neg[reg1:=-1024][yy' := -1024](reg1\in INT\et reg1\in[-1024..1023]\et vv = yy')))))$
$\et$\\
$\tab{1em}(\neg({xx+reg1} < -1024)\fleche$\\
$\tab{2em}(( {xx+reg1} > 1023)\fleche$\\
$\tab{3em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\fleche\neg[reg1:=1023][yy' := 1023](reg1\in INT\et reg1\in[-1024..1023])\et vv = yy')))$
$\tab{1em}\et$\\
$\tab{1em}(\neg( {xx+reg1} > 1023)\fleche$\\
$\tab{2em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em}\fleche\neg[reg1 := {xx+reg1}][yy' := {xx+reg1}](reg1\in INT\et reg1\in[-1024..1023]\et vv = yy')))))$

\bigskip\noindent
(18)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$(({xx+reg1} < -1024)\fleche$\\
$\tab{1em}((-1024 > 1023)\fleche$\\
$\tab{2em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em}\fleche\neg(1023\in INT\et 1023\in[-1024..1023]\et vv = 1023))))$\\
$\tab{1em}\et$\\
$\tab{1em}(\neg(-1024 > 1023)\fleche$\\
$\tab{2em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em}\fleche\neg(-1024\in INT\et -1024\in[-1024..1023]\et vv = -1024)))))$\\
$\et$\\
$(\neg({xx+reg1} < -1024)\fleche$\\
$\tab{1em}(({xx+reg1} > 1023)\fleche$\\
$\tab{2em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em}\fleche\neg(1023\in INT\et 1023\in[-1024..1023]\et vv = 1023))))$\\
$\tab{1em}\et$\\
$\tab{1em}(\neg( {xx+reg1} > 1023)\fleche$\\
$\tab{2em}\neg(\forall vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em}\fleche\neg((xx+reg1)\in INT\et (xx+reg1)\in[-1024..1023]\et vv = (xx+reg1))))))$

\bigskip\noindent
(19)\\
$(reg1\in INT\et reg1\in[-1024..1023]\et xx\et Int\et xx\in[-256..255])$\\
$\fleche$\\
$(({xx+reg1} < -1024)\et (-1024 > 1023)\fleche$\\
$\tab{1em}\exists vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}
 \et 1023\in INT\et 1023\in[-1024..1023]\et vv = 1023))$\\
$\et$\\
$(({xx+reg1} < -1024)\et \neg(-1024 > 1023)\fleche$\\
$\tab{1em}\exists vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}
 \et -1024\in INT\et -1024\in[-1024..1023]\et vv = -1024)))$\\
$\et$\\
$(\neg({xx+reg1} < -1024)\et ({xx+reg1} > 1023)\fleche$\\
$\tab{1em}\exists vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] 
 \et 1023\in INT\et 1023\in[-1024..1023]\et vv = 1023)))$\\
$\et$\\
$(\neg({xx+reg1} < -1024)\et \neg( {xx+reg1} > 1023)\fleche$\\
$\tab{1em}\exists vv (vv\in \{ ee | ee\in INT \et ee\in [-1024..1023] \}$\\
$\tab{3em} \et (xx+reg1)\in INT\et (xx+reg1)\in[-1024..1023]\et vv = (xx+reg1)))$


\emph{Note: cette démonstration a été écrite par Pascal Manoury.}
